<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>优惠管理</title>
</head>
<script src="jquery-1.8.3.min.js" type="text/javascript"></script>
<script type="text/javascript">

    //点击全选，子复选框被选中
    function demo() {
        var allcheck=document.getElementById("allcheck");
        var choice=document.getElementsByName("choice");
        for(var i=0;i<choice.length;i++){
            choice[i].checked=allcheck.checked;
        }
    }

    //点击子复选框,全选框 选中、取消
    function setAll() {
        if (!$(".checknum").checked) {
            $("#allcheck").prop("checked", false);// 子复选框某个不选择，全选也被取消
        }
        var choicelength = $("input[type='checkbox'][class='checknum']").length;
        var choiceselect = $("input[type='checkbox'][class='checknum']:checked").length;

        if (choicelength == choiceselect) {
            $("#allcheck").prop("checked", true);   // 子复选框全部部被选择，全选也被选择；1.对于HTML元素我们自己自定义的DOM属性，在处理时，使用attr方法；2.对于HTML元素本身就带有的固有属性，在处理时，使用prop方法。
        }
    }

    function updateupper(id){
        $.getJSON("updateuppershelf","id="+id,function (data) {
            if(data.error=="yes"){
                alert("优惠上架成功");
                location.href="selectalldiscounts";
            }
        })
    }

    function updatelower(id){
        $.getJSON("updatelowershelf","id="+id,function (data) {
            if(data.error=="yes"){
                alert("优惠下架成功");
                location.href="selectalldiscounts";
            }
        })
    }

    function c(id) {
        alert(1)
        if(confirm("是否删除该优惠？")){
            location.href="/discountsdel?id="+id;
        }
    }

    $(function(){
        $("#cha").blur(function () {
            var cha=$(this).val();
            location.href="selectalldiscounts?page="+cha+"";
        });
    });

</script>
<body>
<a href="/index" style="font-size: 30px;color: red">×</a>
<h2>优惠管理</h2>
    <form>
        <button id="add"><a href="getdiscountadd"><b>+</b>新增优惠</a></button>
        <table border="1">
            <tr>
                <td><input type="checkbox" id="allcheck" onclick="demo()"/></td>
                <td>服务范围</td><td>优惠类型</td><td>折扣金额</td><td>使用规则</td><td>数量</td><td>使用时间</td><td>状态</td><td>操作</td>
            </tr>
            <tr th:each="dis:${dislist}">
                <td><input type="checkbox" name="choice" onclick="setAll()" class="checknum" />
                <td th:text="${dis.service.serviceScope}"></td>
                <td>
                    <span th:if="${dis.discountType}==1">折扣券</span>
                    <span th:if="${dis.discountType}==2">现金券</span>
                </td>
                <td th:text="${dis.discountMoney}"></td>
                <td>
                    <span th:if="${dis.firstImpose}==1">首次服务</span><span th:if="${dis.firstImpose}==2">非首次服务</span>,
                    <span th:if="${dis.superposition}==1">允许叠加</span><span th:if="${dis.superposition}==2">不可叠加</span>
                </td>
                <td th:text="${dis.discountCount}"></td>
                <td th:text="${dis.useDate}"></td>
                <td>
                    <span th:if="${dis.status}==1">已上架</span>
                    <span th:if="${dis.status}==2">已下架</span>
                    <span th:if="${dis.status}==3">已领完</span>
                </td>
                <td>
                    <span th:if="${dis.status}==1"><a th:href="'javascript:updateupper('+${dis.id}+');'" style="display: none">上架优惠</a></span>
                    <span th:if="${dis.status}!=1"><a th:href="'javascript:updateupper('+${dis.id}+');'">上架优惠</a></span>
                    <span th:if="${dis.status}==2"><a th:href="'javascript:updatelower('+${dis.id}+');'" style="display: none">下架优惠</a></span>
                    <span th:if="${dis.status}!=2"><a th:href="'javascript:updatelower('+${dis.id}+');'">下架优惠</a></span>
                    <span th:if="${dis.status}==3"><a th:href="'javascript:c('+${dis.id}+');'" style="display: none">删除优惠</a></span>
                    <span th:if="${dis.status}!=3"><a th:href="'javascript:c('+${dis.id}+');'">删除优惠</a></span>
                </td>
            </tr>
        </table>
            <div>
                <span th:if="${pages.currPage}>1">
                    <a href="selectalldiscounts?page=1">首页</a>
                    <a th:href="@{/selectalldiscounts(page=${pages.currPage -1})}"><</a>
                </span>
                <span th:each="i:${#numbers.sequence(1,pages.totalPage)}">
                    <a th:href="@{/selectalldiscounts(page=${i})}" th:text="${i}"></a>
                </span>
                <span th:if="${pages.currPage}<${pages.totalPage}">
                    <a th:href="@{/selectalldiscounts(page=${pages.currPage+1})}">></a>
                    <a th:href="@{/selectalldiscounts(page=${pages.totalPage})}">尾页</a>
                </span>
                <span>共<span th:text="${pages.totalCount}"></span>条&nbsp;&nbsp;前往&nbsp;&nbsp;<input type="text" id="cha" th:value="${currentPage}" style="width: 35px;height: 17px;text-align: center">&nbsp;&nbsp;页</span>
            </div>
    </form>
</body>
</html>